/*
    groph 0.7.0

    (c) 2014 Ricky Boyce.
    groph may be freely distributed under the MIT license.
    For all details and documentation: http://github.com/boyyce/groph

*/!function(){"use strict";function a(a){var b=this,d={selector:"#graph1",w:1008,h:365,pointMax:!1,pointMin:0,displayPointer:!1,graphScale:1,graphPadding:[60,0,50.5,20],data1:[600,500,700,900,500,700,600,900,700],data2:[200,300,100,200,50,150,300,200,300]};return a=a||{},a=_.extend(d,a),b.tipTexWidth=12,b.selector=a.selector,b.target=$(b.selector),b.w=a.w,b.h=a.h,b.cache=a.cache,b.pointMax=a.pointMax,b.pointMin=a.pointMin,b.displayPointer=a.displayPointer,b.graphScale=a.graphScale,b.graphPadding=a.graphPadding,b.data1=a.data1,b.data2=a.data2,b._data1=_.extend([],b.data1),b._data2=_.extend([],b.data2),b.ctp1=[],b.ctp2=[],b.target.length?(c=TWEEN,_.isString(f)&&(f=PIXI.Texture.fromImage(f)),_.isString(g)&&(g=PIXI.Texture.fromImage(g)),_.isString(h)&&(h=PIXI.Texture.fromImage(h)),_.isString(i)&&(i=PIXI.Texture.fromImage(i)),_.isString(j)&&(j=PIXI.Texture.fromImage(j)),_.isString(k)&&(k=PIXI.Texture.fromImage(k)),b.stage=new PIXI.Stage(6750105),b.renderer=new PIXI.CanvasRenderer(this.w+1,this.h,!1,!0),b.target.html(b.renderer.view),b.line1=new PIXI.Graphics,b.line2=new PIXI.Graphics,b.line1Active=!1,b.line2Active=!1,b.defaultIndex=Math.round((b.data1.length-1)/2),b.line1.colorsRB=[9425396,5680639],b.line2.colorsRB=[11516152,11516152],b.pointer=new PIXI.DisplayObjectContainer,b.line=new PIXI.Graphics,b.stand=new PIXI.Graphics,b.dot1=new PIXI.Sprite(f),b.dot2=new PIXI.Sprite(g),b.tip1Box=new PIXI.DisplayObjectContainer,b.tip2Box=new PIXI.DisplayObjectContainer,b.pointer.alpha=0,b.dot1.anchor.set(.5,.5),b.dot2.anchor.set(.5,.5),b.line.beginFill("0x0b2659",.43),b.line.drawRect(0,0,1,a.h),b.line.endFill(),b.stand.beginFill("0x0b2659",.43),b.stand.drawRect(-12,a.h-1,24,1),b.stand.endFill(),b.tip1Box.pivot.set(.5,.5),b.tip2Box.pivot.set(.5,.5),b.tip1Y=13,b.tip2Y=a.h-27,b.stage.addChild(b.line1),b.stage.addChild(b.line2),b.pointer.addChild(b.line),b.pointer.addChild(b.stand),b.pointer.addChild(b.dot1),b.pointer.addChild(b.dot2),b.pointer.addChild(b.tip1Box),b.pointer.addChild(b.tip2Box),b.stage.addChild(b.pointer),b.init=!0,void b.start()):void console.log("selector returned nothing.")}function b(a){var b,c=.1,d=.7;return 0===a?0:1===a?1:(!c||1>c?(c=1,b=d/4):b=d*Math.asin(1/c)/(2*Math.PI),c*Math.pow(2,-10*a)*Math.sin(2*(a-b)*Math.PI/d)+1)}var c,d=!1,e=a.prototype,f="imgs/dot-profit.png",g="imgs/dot-loss.png",h="imgs/tooltip-profit.png",i="imgs/tooltip-loss.png",j="imgs/tooltip-arrow-profit.png",k="imgs/tooltip-arrow-loss.png";e.start=function(a){var b,c,d,e=this;if(!e.init&&e.target&&e.remove(),!e.target){if(a=a||{},e.selector=a.selector||e.selector,e.target=$(e.selector),!e.target.length)return void console.log("selector returned nothing.");a.data1&&(d=!0,e.data1=a.data1,e._data1=_.extend([],e.data1)),a.data2&&(d=!0,e.data1=a.data2,e._data2=_.extend([],e.data2)),e.target.html(e.renderer.view)}if(e.init||d)for(e.removeTooltips(),e.dataConversion(),e.allTips1=[],e.allTips2=[],e.currentTipIndex=!1,b=0,c=e.data1.length;c>b;b++)e.allTips1.push(e.drawTooltip(1,b)),e.allTips2.push(e.drawTooltip(2,b));for(e.init=!1,e.tickers=[],e.initDelays=[],e.lineTweens1=[],e.lineTweens2=[],e.animating={},e.stageMouseOver=!1,e.pointerGo=!1,e.data1Nill=[],e.data2Nill=[],e.ctp1Nill=[],e.ctp2Nill=[],b=0,c=e.data1.length;c>b;b++)this.data1Nill.push({x:e.data1[b].x,y:this.lowest}),this.data2Nill.push({x:e.data2[b].x,y:this.lowest}),b!=c-1&&(this.ctp1Nill.push([{x:this.ctp1[b][0].x,y:this.lowest},{x:this.ctp1[b][1].x,y:this.lowest}]),this.ctp2Nill.push([{x:this.ctp2[b][0].x,y:this.lowest},{x:this.ctp2[b][1].x,y:this.lowest}]));e.drawLines(!0),e.interactivePointer(),e.tickers.push(requestAnimFrame(function(){e.interactiveTicker()})),e.interactiveTickerI=e.tickers.length-1,e.initDelays.push(setTimeout(function(){e.initDelays.splice(0,1),e.startLineTweens()},500)),e.initDelays.push(setTimeout(function(){e.initDelays.splice(1,1),e.pointerGo=!0,e.displayPointer?(e.showPointerTween(),e.movePointerTween({indexRB:e.defaultIndex})):e.stageMouseOver&&e.showPointerTween()},1500))},e.remove=function(){var a,b=this;for(a=b.initDelays.length;a--;)clearTimeout(b.initDelays[a]);for(a=b.lineTweens1.length;a--;)b.lineTweens1[a].stop();for(a=b.lineTweens2.length;a--;)b.lineTweens2[a].stop();for(b.line1Active=!1,b.line2Active=!1,_.each(b.animating,function(a){a&&a.stop()}),a=b.tickers.length;a--;)cancelAnimationFrame(b.tickers[a]);b.tickers=null,b.removeInteractivePointer(),b.target.removeData(),b.target.empty(),b.target=null},e.destroy=function(){this.removeTooltips(),this.remove(),this.stage.interactionManager.removeEvents()},e.interactivePointer=function(){function a(a){i.movePointerTween(a)}function b(){i.showPointerTween()}function c(){i.hidePointerTween()}var d,e,f,g,h,i=this,j=Math.round(this.columnWidth/2);for(i.boxes=new PIXI.DisplayObjectContainer,e=0,f=i.data1.length;f>e;e++)0===e?(d=0,g=j):(d=(e-1)*i.columnWidth+j,g=i.columnWidth),h=new PIXI.Graphics,h.lineStyle(1,"0x000",0),h.drawRect(d,0,g,i.h),h.indexRB=e,h.hitArea=new PIXI.Rectangle(d,0,g,i.h),h.mouseover=a,h.interactive=!0,i.boxes.addChild(h);i.stage.mouseover=b,i.stage.mouseout=c,i.stage.interactive=!0,i.stage.addChild(i.boxes)},e.removeInteractivePointer=function(){var a=this;a.stage.removeChild(a.boxes),a.showHidePointer(0),a.stage.interactive=!1},e.drawLines=function(a){var b=this;(b.line2Active||a)&&b.drawLine(b.line2,b.data2Nill,b.ctp2Nill),(b.line1Active||a)&&b.drawLine(b.line1,b.data1Nill,b.ctp1Nill)},e.drawLine=function(a,b,c){var d,e,f,g,h,i=this;for(a.clear(),f=2;f--;){for(0===f?(g=0,a.lineStyle(5,a.colorsRB[0],1),a.beginFill(a.colorsRB[1],.15),a.moveTo(-10,i.h+10),a.lineTo(-10,b[0].y+g)):(g=1,a.lineStyle(5,"0x7d8fc2",1),a.moveTo(-10,b[0].y+g)),d=0,e=b.length;e>d;d++)d>=e-1||a.bezierCurveTo(c[d][0].x,c[d][0].y+g,c[d][1].x,c[d][1].y+g,b[d+1].x,b[d+1].y+g);h=b.last(),a.bezierCurveTo(h.x,h.y+g,h.x,h.y+g,h.x,h.y+g),a.lineTo(i.w+10,h.y+g),0===f&&(a.lineTo(i.w+10,i.h+10),a.endFill())}},e.movePoints=function(a,b,c){var d,e,f,g,h=this,i=this.lowest;1==a?(d=h.data1Nill,e=h.ctp1Nill,f=h.data1,g=h.ctp1):2==a&&(d=h.data2Nill,e=h.ctp2Nill,f=h.data2,g=h.ctp2),d[b].y=c;var j=(c-i)/(f[b].y-i)*100,k=f.length-1;b!==k&&(e[b][0].y=j*(g[b][0].y-i)/100+i),0!==b&&(e[b-1][1].y=j*(g[b-1][1].y-i)/100+i)},e.showHidePointer=function(a){this.pointer.alpha=a;var b=-38,c=38;this.tip1Box.position.y=b-b*a,this.tip2Box.position.y=c-c*a},e.showHideDots=function(a){this.dot1.scale.set(a,a),this.dot2.scale.set(a,a)},e.movePointer=function(a){this.pointer.position.x=a},e.moveDot1=function(a){this.dot1.position.y=a},e.moveDot2=function(a){this.dot2.position.y=a},e.changeTips=function(a){var b,c,d=this,e=this.currentTipIndex,f=d.allTips1[e].width,g=d.allTips2[e].width;b=Math.round(f/2),c=Math.round(g/2),0===e?(d.allTips1[e].position.x=-b- -b*a,d.allTips2[e].position.x=-c- -c*a):(d.allTips1[e].position.x=-f+2*d.tipTexWidth+(b-b*a),d.allTips2[e].position.x=-g+2*d.tipTexWidth+(c-c*a))},e.drawTooltip=function(a,b){var c,d,e,f=this,g=12,l=new PIXI.DisplayObjectContainer,m=new PIXI.Graphics,n=new PIXI.Text("",{font:"13px Arial",fill:"white"});1==a?(f.tip1Box.addChild(l),c=new PIXI.Sprite(h),d=new PIXI.Sprite(h),e=new PIXI.Sprite(j),l.position.y=-100,m.beginFill("0x6ec0ea",1),n.setText("$"+f._data1[b]+" profit"),e.position.y=22):(f.tip2Box.addChild(l),c=new PIXI.Sprite(i),d=new PIXI.Sprite(i),e=new PIXI.Sprite(k),l.position.y=-100,m.beginFill("0x90a5e8",1),n.setText("$"+f._data2[b]+" loss"),e.scale.y=-1,e.position.y=-6);var o=n.width;return n.position.x=g,l.pivot.set(.5,.5),l.position.x=-(Math.round(o/2)+g-1),m.drawRect(0,-8,o+2*g,31),m.endFill(),c.position.set(-g+1,-9),d.position.set(o-1+3*g,-9),d.scale.x=-1,e.position.x=Math.round(o/2)+g-8,0===b?e.position.x-=Math.round(o/2)+g:b===f.data1.length-1&&(e.position.x+=Math.round(o/2)+g),l.addChild(m),l.addChild(c),l.addChild(d),l.addChild(e),l.addChild(n),l},e.removeTooltips=function(){var a,b;if(this.allTips1)for(a=this.allTips1.length;a--;){for(b=this.allTips1[a].children.length;b--;)this.allTips1[a].children[b].destroy&&this.allTips1[a].children[b].destroy();this.tip1Box.removeChild(this.allTips1[a])}if(this.allTips2)for(a=this.allTips2.length;a--;){for(b=this.allTips2[a].children.length;b--;)this.allTips2[a].children[b].destroy&&this.allTips2[a].children[b].destroy();this.tip2Box.removeChild(this.allTips2[a])}},e.startLineTweens=function(){var a,b,c,d,e=this,f=function(a,b){return function(){e.movePoints(a,b,this.y)}},g=function(){e.line1Active=!0},h=function(){e.line2Active=!0},i=function(){cancelAnimationFrame(e.tickers[e.initTickerI]),e.tickers[e.initTickerI]=null};for(a=0,b=e.data1.length;b>a;a++)c=new TWEEN.Tween({y:e.lowest}).delay(100*(a+1)).to({y:e.data1[a].y},2500).easing(TWEEN.Easing.Elastic.Out).onUpdate(f(1,a)).onStart(g).start(),d=new TWEEN.Tween({y:e.lowest}).delay(100*(a+1)+500).to({y:e.data2[a].y},2500).easing(TWEEN.Easing.Elastic.Out).onUpdate(f(2,a)).onStart(h).start(),e.lineTweens1.push(c),e.lineTweens2.push(d);e.lineTweens1.last().onComplete(function(){e.line1Active=!1}),e.lineTweens2.last().onComplete(function(){e.line1Active=!0,e.line2Active=!0,setTimeout(i,24)}),e.tickers.push(requestAnimFrame(function(){e.initTicker()})),e.initTickerI=e.tickers.length-1},e.showPointerTween=function(){this.stageMouseOver=!0,this.pointerGo&&this.showHidePointerTween(!0)},e.hidePointerTween=function(){this.stageMouseOver=!1,this.pointerGo&&this.showHidePointerTween()},e.showHidePointerTween=function(a){var b,d=this,e=this.pointer.alpha;d.animating.pointer&&d.animating.pointer.stop(),d.animating.dots&&d.animating.dots.stop(),b=a?1:0,d.animating.pointer=new c.Tween({value:e}).to({value:b},250).easing(TWEEN.Easing.Quadratic.InOut).onUpdate(function(){d.showHidePointer(this.value)}).onComplete(function(){d.animating.pointer=null}).start(),d.animating.dots=new c.Tween({value:e}).to({value:b},a?600:300).easing(a?TWEEN.Easing.Elastic.Out:TWEEN.Easing.Quadratic.InOut).onUpdate(function(){d.showHideDots(this.value)}).onComplete(function(){d.animating.dots=null}).start()},e.movePointerTween=function(a){var c=this,d=this.pointer.x,e=this.dot1.y,f=this.dot2.y,g=this.data1,h=this.data2,i=c.animating,j=a.indexRB||a.target.indexRB;c.currentTipIndex!==!1&&(c.allTips1[c.currentTipIndex].position.y=-100,c.allTips2[c.currentTipIndex].position.y=-100),c.currentTipIndex=j,c.displayPointer||(c.allTips1[j].position.y=c.tip1Y,c.allTips2[j].position.y=c.tip2Y),0===c.pointer.alpha?(c.pointer.position.x=g[j].x,c.dot1.position.y=g[j].y,c.dot2.position.y=h[j].y,(0===j||j===g.length-1)&&c.changeTips(1)):(i.pointerx&&i.pointerx.stop(),i.dot1y&&i.dot1y.stop(),i.dot2y&&i.dot2y.stop(),i.tips&&i.tips.stop(),(0===j||j===g.length-1)&&(i.tips=new TWEEN.Tween({value:0}).to({value:1},300).easing(TWEEN.Easing.Quadratic.InOut).onUpdate(function(){c.changeTips(this.value)}).onComplete(function(){i.tips=null}).start()),i.pointerx=new TWEEN.Tween({value:d}).to({value:g[j].x},600).easing(b).onUpdate(function(){c.movePointer(this.value)}).onComplete(function(){i.pointerx=null}).start(),i.dot1y=new TWEEN.Tween({value:e}).to({value:g[j].y},600).easing(b).onUpdate(function(){c.moveDot1(this.value)}).onComplete(function(){i.dot1y=null}).start(),i.dot2y=new TWEEN.Tween({value:f}).to({value:h[j].y},600).easing(b).onUpdate(function(){c.moveDot2(this.value)}).onComplete(function(){i.dot2y=null}).start())},e.initTicker=function(){var a=this;a.tickers[a.initTickerI]=requestAnimFrame(function(){a.initTicker()}),a.drawLines()},e.interactiveTicker=function(a){var b=this;b.tickers[b.interactiveTickerI]=requestAnimFrame(function(){b.interactiveTicker()}),c.update(a),b.renderer.render(b.stage)},e.dataConversion=function(){var a,b,c=this.data1,d=this.data2;for(this.lowest=this.pointsToGraph(),this.columnWidth=Math.round(this.w/(c.length-1)),a=0,b=c.length;b>a;a++)c[a]=b-1>a?{x:a*this.columnWidth,y:c[a]}:{x:this.w,y:c[a]},d[a]=b-1>a?{x:a*this.columnWidth,y:d[a]}:{x:this.w,y:d[a]};for(c.unshift(c[0]),c.push(c.last()),d.unshift(d[0]),d.push(d.last()),a=0,b=c.length;b>a;a++)0===a||a>=b-2||(this.ctp1.push(this.lineControlPoints(c[a-1],c[a],c[a+1],c[a+2],5,.8)),this.ctp2.push(this.lineControlPoints(d[a-1],d[a],d[a+1],d[a+2],5,.8)));c.splice(0,1),c.splice(-1,1),d.splice(0,1),d.splice(-1,1)},e.pointsToGraph=function(){var a,b,c,d,e,f,g,h,i,j=this,k=j.h,l=j.pointMax,m=j.pointMin,n=j.graphPadding,o=j.graphScale,p=j.data1,q=j.data2,r=0+n[0],s=k-n[2];1!==o&&(b=s-r,c=Math.round(b/2),d=Math.round(b*o/2),r=c-d,s=c+d);var t=p.concat(q);_.isNumber(l)&&t.push(l),_.isNumber(m)&&t.push(m),l=_.max(t),m=_.min(t);var u=l-m,v=s-r,w=m;for(a=p.length;a--;)p[a]-=w,e=p[a],g=p[a]/u*100,h=g,g=100-g,i=g,p[a]=g*v/100,f=p[a],p[a]=Math.round(p[a]+r),g=q[a]/u*100,g=100-g,q[a]=g*v/100,q[a]=Math.round(q[a]+r);return s},e.lineControlPoints=function(a,b,c,e,f,g){f=f||5;var h=this.findControlPoints(a,b,c),i=this.findControlPoints(b,c,e),j=h.c2,k=i.c1;return d&&(this.plotSquare(j,3,"0xff0000"),this.plotLine(b,j,"0xfc69f7"),this.plotSquare(k,3,"0xff0000"),this.plotLine(c,k,"0xfc69f7")),g!==!1&&(j.x=b.x-(b.x-j.x)*g,j.y=b.y-(b.y-j.y)*g,k.x=c.x-(c.x-k.x)*g,k.y=c.y-(c.y-k.y)*g),[j,k]},e.findControlPoints=function(a,b,c){var e=a.x-b.x,f=a.y-b.y,g=b.x-c.x,h=b.y-c.y,i=Math.sqrt(e*e+f*f),j=Math.sqrt(g*g+h*h),k={x:(a.x+b.x)/2,y:(a.y+b.y)/2},l={x:(b.x+c.x)/2,y:(b.y+c.y)/2},m=k.x-l.x,n=k.y-l.y,o=j/(i+j),p={x:l.x+m*o,y:l.y+n*o},q=b.x-p.x,r=b.y-p.y,s={x:k.x+q,y:k.y+r},t={x:l.x+q,y:l.y+r};return d&&(this.plotLine(a,b,"0xdfcb45"),this.plotLine(b,c,"0xdfcb45"),this.plotPoint(k,1,"0x6ae676"),this.plotPoint(l,1,"0x1ad32b"),this.plotLine(k,l,"0x6ae676"),this.plotPoint(p,1,"0x3086e7")),{c1:s,c2:t,l1:Math.floor(i),l2:Math.floor(j)}},e.plotPoint=function(a,b,c){var d=new PIXI.Graphics;d.lineStyle(0,c),d.beginFill(c),d.drawCircle(a.x-b/2,a.y-b/2,b),d.endFill(),this.stage.addChild(d)},e.plotLine=function(a,b,c){var d=new PIXI.Graphics;d.lineStyle(1,c),d.moveTo(a.x,a.y),d.lineTo(b.x,b.y),this.stage.addChild(d)},e.plotSquare=function(a,b,c){var d=new PIXI.Graphics;d.lineStyle(0,c),d.beginFill(c),d.drawRect(a.x-b/2,a.y-b/2,b,b),d.endFill(),this.stage.addChild(d)},Array.prototype.last||(Array.prototype.last=function(){return this[this.length-1]}),window.Groph=a}();